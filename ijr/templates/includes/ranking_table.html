<!-- variables: state_rankings, score_field, rank_field, delta_field, color_field -->

<table class="table-ranking">
  <thead>
    <tr>
      <th>Rank</th>
      <th>State</th>
      <th class="text-right whitespace-nowrap">Score (out of 10)</th>
    </tr>
  </thead>
  <tbody>
    {% for d in state_rankings %}
    {% set score = d[score_field] %}
    {% set rank = d[rank_field] %}
    {% set delta = (d[delta_field] or 0) * -1 %}
    <tr data-state="{{ d.region_code }}">
      <td align="center">
        <div class="rank-circle">{{ rank }}</div>
      </td>
      <td width="250">
        <a href="/state/{{ d.region_code }}" style="font-weight:500">{{ d.state }}</a>
      </td>
      <td title="{{ '+' if delta > 0 else '' }}{{ delta }}">
        <div class="d-flex align-items-center">
          <div class="rank-bar-container">
            <div class="rank-bar" style="
                width: calc(({{ (score | flt) }} * var(--bar-width)) / 10 );
                background-color: {{ d[color_field] }};
              "></div>
          </div>
          <div class="text-center" style="width: 16px;">
            <span class="{% if delta == 0 %} delta-same {% elif delta > 0 %} delta-increase {% else %} delta-decrease {% endif %}">
              {% if delta == 0 %} &ndash; {% elif delta > 0 %} ▲ {% else %} ▼ {% endif %}
            </span>
          </div>
          <div class="pl-1" style="font-variant-numeric: tabular-nums;">
            {% if score is not none %}
            {{ "%.2f" % frappe.utils.rounded(score, 2) }}
            {% endif %}
          </div>
        </div>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>